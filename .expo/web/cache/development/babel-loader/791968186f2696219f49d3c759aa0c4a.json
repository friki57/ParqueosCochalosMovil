{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactNative = require(\"react-native\");\n\nvar _Marcador = _interopRequireDefault(require(\"./Marcador\"));\n\nvar _maps = _interopRequireDefault(require(\"@react-native-mapbox-gl/maps\"));\n\nvar _geolocation = _interopRequireDefault(require(\"@react-native-community/geolocation\"));\n\nvar _socketIo = _interopRequireDefault(require(\"socket.io-client/dist/socket.io.js\"));\n\nvar _jsxFileName = \"/Users/angelaranibar/Erick/ParqueosCochalosMovil-master/Movil/ParqueosCochalos/src/Vista/Componentes/Mapas/Mapa.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n_maps.default.setAccessToken(\"pk.eyJ1IjoiZnJpa2k1NyIsImEiOiJjanZxOGtxMjgwaDhxNDRvOHl5NDVvZnQyIn0._cULjNb2IP5SLSBSm7Higw\");\n\n_maps.default.setConnected(true);\n\nvar Mapa = function (_Component) {\n  (0, _inherits2.default)(Mapa, _Component);\n\n  var _super = _createSuper(Mapa);\n\n  function Mapa(props) {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, Mapa);\n    _this = _super.call(this, props);\n    _this.state = {\n      ubicacion: _this.props.ubicacion,\n      ubicacionActual: undefined,\n      MarcadorUbicacion: undefined,\n      Calles: undefined\n    };\n    _this.actualizar = _this.actualizar.bind((0, _assertThisInitialized2.default)(_this));\n    setTimeout(function () {\n      _this.socket = (0, _socketIo.default)('http://104.129.131.142:4000', {\n        transports: ['websocket'],\n        jsonp: false\n      });\n\n      _this.socket.connect();\n\n      _this.socket.on('calles', function (res) {\n        _this.actualizar(res);\n      });\n    }, 1000);\n\n    _geolocation.default.getCurrentPosition(function (posicion) {\n      var ubicacion = posicion;\n\n      _this.setState({\n        ubicacionActual: [ubicacion.coords.longitude, ubicacion.coords.latitude]\n      });\n\n      if (_this.state.ubicacion == undefined) {\n        _this.setState({\n          ubicacion: _this.state.ubicacionActual\n        });\n      }\n\n      _this.setState({\n        MarcadorUbicacion: _react.default.createElement(_Marcador.default, {\n          ubicacion: _this.state.ubicacion,\n          texto: \"Usted est\\xE1 ac\\xE1\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 44,\n            columnNumber: 33\n          }\n        })\n      });\n\n      fetch(\"http://104.129.131.142:4000/MapasMovil\").then(function (res) {\n        return res.json();\n      }).then(function (data) {\n        _this.actualizar(data);\n      });\n    }, function (error) {\n      return _reactNative.Alert.alert(\"Imposible obtener la localizaci√≥n.\\nFavor de conectarse a internet.\");\n    }, {\n      enableHighAccuracy: true,\n      timeout: 20000,\n      maximumAge: 5000\n    });\n\n    return _this;\n  }\n\n  (0, _createClass2.default)(Mapa, [{\n    key: \"actualizar\",\n    value: function actualizar(data) {\n      if (this.state.Calles != undefined) {\n        var m = this.state.Calles.map(function (ca) {});\n        console.log(this.state.Calles[0]);\n      }\n\n      this.setState({\n        Calles: undefined\n      });\n      data = data.filter(function (a) {\n        return a != undefined;\n      });\n      data = data.filter(function (a) {\n        return a.geojson != undefined;\n      });\n      data = data.map(function (a) {\n        a.lon = (a.geojson[0].lon + a.geojson[1].lon) / 2;\n        a.lat = (a.geojson[0].lat + a.geojson[1].lat) / 2;\n        return a;\n      });\n      var marcadores = data.map(function (a, i) {\n        if (a.espacios != undefined) {\n          return _react.default.createElement(_Marcador.default, {\n            ubicacion: [a.lon, a.lat],\n            texto: a.calle + \" entre \" + a.c1 + \" y \" + a.c2 + \"\\nEspacios disponibles: \" + (10 - a.espacios),\n            key: i,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 86,\n              columnNumber: 13\n            }\n          });\n        }\n      });\n      this.setState({\n        Calles: marcadores\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return _react.default.createElement(_react.default.Fragment, null, _react.default.createElement(_maps.default.MapView, {\n        style: styles.container,\n        styleURL: _maps.default.StyleURL.Street,\n        logoEnabled: false,\n        attributionEnabled: false,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 7\n        }\n      }, _react.default.createElement(_maps.default.Camera, {\n        ref: function ref(_ref) {\n          return _this2.camera = _ref;\n        },\n        zoomLevel: 15,\n        centerCoordinate: this.state.ubicacion,\n        animationDuration: 2000,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 9\n        }\n      }), _react.default.createElement(_reactNative.View, {\n        ref: function ref(_ref2) {\n          return _this2.ubicacionActual = _ref2;\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 9\n        }\n      }), this.state.MarcadorUbicacion, this.state.Calles), _react.default.createElement(_reactNative.Text, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 7\n        }\n      }, this.state.ubicacion));\n    }\n  }]);\n  return Mapa;\n}(_react.Component);\n\nvar _default = Mapa;\nexports.default = _default;\nvar styles = {\n  container: {\n    height: 600,\n    width: 400,\n    backgroundColor: \"transparent\"\n  }\n};","map":{"version":3,"sources":["/Users/angelaranibar/Erick/ParqueosCochalosMovil-master/Movil/ParqueosCochalos/src/Vista/Componentes/Mapas/Mapa.js"],"names":["MapboxGL","setAccessToken","setConnected","Mapa","props","state","ubicacion","ubicacionActual","undefined","MarcadorUbicacion","Calles","actualizar","bind","setTimeout","socket","transports","jsonp","connect","on","res","Geolocation","getCurrentPosition","posicion","setState","coords","longitude","latitude","fetch","then","json","data","error","Alert","alert","enableHighAccuracy","timeout","maximumAge","m","map","ca","console","log","filter","a","geojson","lon","lat","marcadores","i","espacios","calle","c1","c2","styles","container","StyleURL","Street","ref","camera","Component","height","width","backgroundColor"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { View,  Text, Alert } from 'react-native';\nimport Marcador from \"./Marcador\"\nimport MapboxGL from \"@react-native-mapbox-gl/maps\";\nimport Geolocation from '@react-native-community/geolocation';\nimport SocketIOClient from 'socket.io-client/dist/socket.io.js'\n\nMapboxGL.setAccessToken(\"pk.eyJ1IjoiZnJpa2k1NyIsImEiOiJjanZxOGtxMjgwaDhxNDRvOHl5NDVvZnQyIn0._cULjNb2IP5SLSBSm7Higw\");\nMapboxGL.setConnected(true);\n\nclass Mapa extends Component\n{\n  constructor(props){\n    super(props);\n    this.state = {\n      ubicacion: this.props.ubicacion,\n      ubicacionActual: undefined,\n      MarcadorUbicacion: undefined,\n      Calles: undefined\n    }\n    this.actualizar = this.actualizar.bind(this);\n    setTimeout(()=>\n    {\n      this.socket = SocketIOClient('http://104.129.131.142:4000', { transports: ['websocket'], jsonp: false });\n      this.socket.connect();\n      this.socket.on('calles', (res)=>\n      {\n        this.actualizar(res)\n      });\n    },1000)\n    Geolocation.getCurrentPosition(\n      posicion => {\n        const ubicacion = (posicion);\n\n        this.setState({ ubicacionActual:\n          [ubicacion.coords.longitude,\n          ubicacion.coords.latitude]\n         });\n        if(this.state.ubicacion == undefined)\n        {\n          this.setState({ubicacion: this.state.ubicacionActual})\n        }\n        this.setState(\n          {MarcadorUbicacion : (<Marcador ubicacion = {this.state.ubicacion} texto = \"Usted est√° ac√°\"></Marcador>)}\n        );\n        fetch(\"http://104.129.131.142:4000/MapasMovil\")\n          .then(res => res.json())\n          .then(data => {\n            //console.log(data);\n            this.actualizar(data);\n          });\n      },\n      error => Alert.alert(\"Imposible obtener la localizaci√≥n.\\nFavor de conectarse a internet.\"),\n      { enableHighAccuracy: true, timeout: 20000, maximumAge: 5000 }\n    );\n  }\n  actualizar(data)\n  {\n    if(this.state.Calles!=undefined)\n    {\n      var m = this.state.Calles.map((ca)=>\n      {\n        // ca.selected = false;\n      })\n      // this.setState(\n      //   {Calles: m}\n      // );\n      console.log(this.state.Calles[0]);\n    }\n    this.setState({Calles:undefined})\n    data = data.filter(a=>a!=undefined)\n    data = data.filter(a=>a.geojson!=undefined)\n    data = data.map(\n      (a)=>\n      {\n        a.lon = (a.geojson[0].lon + a.geojson[1].lon)/2;\n        a.lat = (a.geojson[0].lat + a.geojson[1].lat)/2;\n        return a;\n      }\n    )\n    var marcadores = data.map((a,i)=>\n      {\n        if(a.espacios!=undefined)\n        {\n          return (\n            <Marcador ubicacion = {[a.lon, a.lat]} texto={(a.calle+\" entre \"+a.c1+\" y \"+a.c2+\"\\nEspacios disponibles: \"+(10-a.espacios))} key = {i}></Marcador>\n          )\n        }\n      })\n\n\n    this.setState(\n      {\n        Calles: marcadores\n      }\n    )\n  }\n  render()\n  {\n    return (\n      <>\n      <MapboxGL.MapView\n        style={styles.container}\n        styleURL={MapboxGL.StyleURL.Street}\n        logoEnabled = {false}\n        attributionEnabled = {false} >\n        <MapboxGL.Camera ref={(ref) => (this.camera = ref)}\n          zoomLevel={15}\n          centerCoordinate={this.state.ubicacion}\n          animationDuration={2000} />\n        <View ref={(ref) => (this.ubicacionActual = ref)}/>\n        {this.state.MarcadorUbicacion}\n        {this.state.Calles}\n      </MapboxGL.MapView>\n      <Text>{this.state.ubicacion}</Text>\n      </>\n    )\n  }\n}\nexport default Mapa;\n\nconst styles = {\n  container: {\n    height: 600,\n    width: 400,\n    backgroundColor: \"transparent\"\n  }\n};\n"]},"metadata":{},"sourceType":"script"}